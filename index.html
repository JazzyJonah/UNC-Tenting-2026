<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>UNC Tenting Schedules</title>

    <!-- Bootstrap for responsive layout -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="css/styles.css" />

    <!-- CSV parser (simple + reliable) -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom sticky-top">
      <div class="container">
        <span class="navbar-brand fw-semibold">UNC Tenting Schedules</span>
        <div class="ms-auto d-flex gap-2 align-items-center">
          <span id="whoami" class="text-muted small d-none d-md-inline"></span>
          <button id="logoutBtn" class="btn btn-outline-secondary btn-sm d-none">
            Log out
          </button>
        </div>
      </div>
    </nav>

    <main class="container py-4">
      <!-- Global messages -->
      <div id="toastArea" class="mb-3"></div>

      <!-- Loading -->
      <div id="loadingCard" class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center gap-3">
            <div class="spinner-border" role="status" aria-label="Loading"></div>
            <div>
              <div class="fw-semibold">Loading schedule…</div>
              <div class="text-muted small">Reading data/schedule.csv</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Login -->
      <section id="loginSection" class="d-none">
        <div class="row justify-content-center">
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
              <div class="card-body">
                <h1 class="h4 mb-2">Log in</h1>
                <p class="text-muted mb-3">
                  Enter your name exactly as it appears in the schedule.
                </p>

                <form id="loginForm" class="d-flex gap-2">
                  <input
                    id="nameInput"
                    class="form-control"
                    placeholder="e.g., Alex"
                    autocomplete="off"
                    required
                  />
                  <button class="btn btn-primary" type="submit">Enter</button>
                </form>

                <div class="alert alert-info mt-3 mb-0 small">
                  Admin view: enter <span class="font-monospace">secret</span>
                </div>
              </div>
            </div>

            <div class="mt-3 small text-muted">
              Tip: for local testing, open this site via a local server (not file://),
              so the browser can fetch <span class="font-monospace">data/schedule.csv</span>.
            </div>
          </div>
        </div>
      </section>

      <!-- User Dashboard -->
      <section id="userSection" class="d-none">
        <div class="row g-3">
          <div class="col-12">
            <div class="card shadow-sm">
              <div class="card-body">
                <div class="d-flex flex-wrap justify-content-between gap-2 align-items-center">
                  <div>
                    <h2 class="h5 mb-1">Your shifts</h2>
                    <div id="weekLabel" class="text-muted small"></div>
                    <div id="sweepIndicator" class="text-muted small mt-1"></div>
                  </div>

                  <div class="d-flex gap-2">
                    <button id="prevWeekBtn" class="btn btn-outline-primary btn-sm">
                      ← Prev
                    </button>
                    <button id="nextWeekBtn" class="btn btn-outline-primary btn-sm">
                      Next →
                    </button>
                  </div>
                </div>

                <hr />

                <div id="verifyPanel" class="d-none">
                  <div class="alert alert-warning mb-3">
                    <div class="fw-semibold">Verify attendance</div>
                    <div class="small">
                      Verification is available only from <b>15 minutes before</b> a shift starts
                      until the shift start time.
                    </div>
                  </div>

                  <div id="verifyList" class="d-grid gap-2"></div>
                  <hr />
                </div>

                <div id="shiftList" class="list-group"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Admin Dashboard -->
      <section id="adminSection" class="d-none">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
              <div>
                <h2 class="h5 mb-1">Admin: Missed shifts</h2>
                <div class="text-muted small">Newest first. You can override missed → verified.</div>
              </div>
              <button id="refreshAdminBtn" class="btn btn-outline-primary btn-sm">
                Refresh
              </button>
            </div>

            <hr />

            <div id="adminList" class="list-group"></div>
          </div>
        </div>
      </section>

      <footer class="mt-4 text-center text-muted small">
        Uses browser geolocation. Works best on HTTPS (GitHub Pages is HTTPS).
      </footer>
    </main>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
